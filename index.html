<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIA Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #d4d4d4;
            display: flex;
            justify-content: flex-start; /* start at top to avoid clipping */
            align-items: center;
            min-height: 100vh; /* was height: 100vh; allow content to grow */
            text-align: center;
            overflow-x: hidden; /* avoid sideways overflow */
            overflow-y: auto;   /* allow vertical scroll so text isn't cut off */
            flex-direction: column;
            padding: 6rem 0 4rem; /* breathing room top/bottom */
        }

        .container {
            position: absolute;
            top: 2rem;
            left: 2rem;
            display: flex;
            align-items: center;
            padding: 0;
            text-align: left;
            flex-direction: row;
        }
        
        .main-content {
            position: relative;
            z-index: 10;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            color: #d4d4d4;
            text-decoration: none;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #fff;
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 1rem;
        }
        
        .logo svg {
            width: 100%;
            height: 100%;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #e0e0e0;
            margin: 0;
            letter-spacing: 0.05em;
        }

        p {
            font-size: 0.75rem;
            font-weight: 400;
            line-height: 1.6;
            color: #a0a0a0;
            margin-top: 0.25rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Leaderboard specific styles */
        #leaderboard .main-content {
            min-height: calc(100vh - 8rem);
            padding: 2rem 0;
        }

        #leaderboard-table {
            font-size: 0.9rem;
        }

        #leaderboard-table th {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #leaderboard-table tbody tr:hover {
            background: rgba(255,255,255,0.05);
            transform: scale(1.005);
        }

        .rank-badge {
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #leaderboard-table {
                font-size: 0.8rem;
            }
            
            #leaderboard-table th,
            #leaderboard-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .main-content {
                padding: 1rem;
            }
        }

        /* Floating Leaderboard Button Styles */
        .leaderboard-btn { /* updated minimal style */
            background: rgba(40,40,40,0.85);
            color: #d4d4d4;
            font-weight: 600;
            padding: 0.85rem 1.1rem;
            border-radius: 9999px;
            border: 1px solid #2a2a2a;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            box-shadow: 0 4px 10px -4px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.04);
            transition: background .25s ease, color .25s ease, border-color .25s ease, box-shadow .25s ease, transform .25s ease;
        }

        .leaderboard-btn:hover {
            background: rgba(58,58,58,0.9);
            color: #fff;
            border-color: #3a3a3a;
            box-shadow: 0 6px 14px -4px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.06);
        }

        .leaderboard-btn:active {
            transform: translateY(1px);
            background: rgba(70,70,70,0.95);
        }

        .leaderboard-btn .icon {
            font-size: 1rem;
            line-height: 1;
        }

        .leaderboard-btn .label { /* hide on very small screens */
            display: none;
        }

        @media (min-width: 480px) { .leaderboard-btn .label { display: inline; } }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <!-- Navigation -->
    <nav class="absolute top-0 right-0 p-4">
        <a class="nav-link" onclick="showPage('mission1')">Question 3</a>
        <a class="nav-link" onclick="showPage('mission2')">Question 4</a>
        <a class="nav-link" onclick="showPage('mission5')">Question 5</a>
        <a class="nav-link" onclick="showPage('mission6')">Question 6</a>
        <a class="nav-link" onclick="showPage('mission7')">Question 7</a>
    </nav>

    <!-- Floating Leaderboard Button -->
    <div class="fixed bottom-6 right-6 z-50">
        <button onclick="showPage('leaderboard')" class="leaderboard-btn" aria-label="Open Leaderboard">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">LEADERBOARD</span>
        </button>
    </div>

    <div class="container">
        <div class="logo">
            <!-- Simplified CIA Seal SVG -->
            <svg xmlns="svg image logo.svg" viewBox="0 0 100 100">
                <!-- Outer circle -->
                <circle cx="50" cy="50" r="48" stroke="#ffffff" stroke-width="2" fill="transparent"/>
                <!-- Compass Rose with 16 points -->
                <polygon points="50,5 56,23 75,23 59,33 65,50 56,67 75,77 56,77 50,95 44,77 25,77 41,67 35,50 44,33 25,23 44,23" fill="#ffffff"/>
                <!-- Eagle head -->
                <path d="M50,42 c10,-2 15,-12 12,-18 c-3,-6 -12,-5 -22,-2 c-10,3 -15,12 -12,18 c3,6 12,5 22,2 z" fill="#1a1a1a" stroke="#ffffff" stroke-width="0.5" />
                <!-- Shield shape -->
                <path d="M50,55 L75,50 L75,75 L50,85 L25,75 L25,50 Z" fill="#ffffff" stroke="#ffffff" stroke-width="0.5"/>
            </svg>
        </div>
        <div class="header-content">
            <h1>
                CIA
            </h1>
            <p>
                We are the Nation's first line of defense.
            </p>
        </div>
    </div>

    <!-- Page Content -->
    <div id="mission1" class="page active">
        <div class="main-content">
             <style>
                @import url("https://fonts.googleapis.com/css2?family=Space+Mono&display=swap");

                                html,
                                body {
                                    margin: 0; /* keep default padding from global styles */
                                }

                body::before {
                    content: '';
                    background-color: #000;
                    background-image: url("https://assets.codepen.io/37111/cat-eyes.jpg");
                    background-size: contain;
                    background-position: center;
                    background-repeat: no-repeat;
                    position: fixed; /* stay fixed while content scrolls */
                    inset: 0;
                    filter: brightness(50%);
                    pointer-events: none; /* don't block pointer tracking */
                    z-index: 0;
                }

                .text-block {
                    margin: 10vh auto; /* center horizontally */
                    padding: 0 8vw;   /* increased side padding for scramble text */
                    max-width: 800px;
                    font-family: "Space Mono", monospace;
                    font-weight: 400;
                    font-style: normal;
                    font-size: clamp(15px, 2.8vw, 28px); /* reduced size for better fit */
                    color: #fff;
                    text-shadow: 1px 1px 2px #000;
                    position: relative;
                    z-index: 10;
                    text-align: center;         /* center the text */
                    overflow-wrap: normal;      /* keep horizontal flow */
                    word-break: normal;         /* avoid per-char vertical stacking */
                }
                /* Ensure paragraph uses the container font size instead of global small p size */
                #mission1 .text-block p { font-size: inherit; line-height: 1.5; margin: 0.4em 0; }
                #mission1 .text-block h3 { margin: 0 0 0.4em; font-weight: 700; }
                #mission1 .text-block h3 a { color: #60a5fa; text-decoration: underline; text-underline-offset: 2px; transition: color 0.2s ease; }
                #mission1 .text-block h3 a:hover { color: #93c5fd; }
                #mission1 .text-block h3 a:visited { color: #60a5fa; }
                #mission1 .text-block ul, 
                #mission1 .text-block ol { 
                    text-align: left;           /* lists read better left-aligned */
                    margin: 0.5em auto; 
                    padding-left: 1.2em; 
                    max-width: 36ch;           /* avoid overly long lines */
                }
                #mission1 .text-block li { margin: 0.2em 0; }
            </style>
            <div class="text-block">
                <div id="riddle">
                    <h3><a href="https://drive.google.com/file/d/1Fd0ApzRxoWYWa8tPZn1e5Ff_JY5V5LM1/view" target="_blank" rel="noopener noreferrer">The Riddle of Six</a></h3>
                    <p>A voice hides a message.<br/>The key lies only in these fragments of time:</p>
                    <ul>
                        <li><code>17.96 ‚Üí 18.95</code> (harvest 3)</li>
                        <li><code>1.23.95 ‚Üí 1.24.5</code> (harvest 1)</li>
                        <li><code>01.00.99 ‚Üí 01.01.30</code> (harvest 1)</li>
                        <li><code>0.51.09 ‚Üí 0.51.75</code> (harvest 1)</li>
                    </ul>
                    <h3>Instructions, whispered:</h3>
                    <ol>
                        <li>Catch the sounds that live between the marks.</li>
                        <li>Strip away all space and clutter.</li>
                        <li>Gather only the number of letters demanded.</li>
                        <li>Bind them in the given order.</li>
                        <li>Break the chain into six clear words.</li>
                    </ol>
                    <p><strong>Answer sought:</strong> A single <strong>six-word sentence</strong> that reveals itself only to those who listen carefully.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="mission2" class="page">
        <div class="main-content">
            <!-- Question 4 -->
            <div class="mt-10">
                    <h3 class="text-2xl md:text-3xl font-semibold text-white mb-2">Question 4</h3>
                    <p class="text-base md:text-lg mb-6">You are tasked with finding the nearest McDonald's and its coordinates.</p>
                    <div class="space-y-6">
                        <!-- Large primary image -->
                        <img src="image.png" alt="Primary reference" class="w-full max-w-3xl mx-auto rounded shadow object-contain max-h-[420px]" />

                        <!-- First row of smaller images (3 across) -->
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 place-items-center">
                            <img src="image2.png" alt="Reference 2" class="w-full max-h-56 object-contain rounded shadow" />
                            <img src="image3.png" alt="Reference 3" class="w-full max-h-56 object-contain rounded shadow" />
                            <img src="image4.png" alt="Reference 4" class="w-full max-h-56 object-contain rounded shadow" />
                        </div>

                        <!-- Second row of smaller images (2 centered) -->
                        <div class="grid grid-cols-2 gap-4 place-items-center md:max-w-[60%] mx-auto">
                            <img src="image5.png" alt="Reference 5" class="w-full max-h-56 object-contain rounded shadow" />
                            <img src="image6.png" alt="Reference 6" class="w-full max-h-56 object-contain rounded shadow" />
                        </div>
                    </div>
            </div>
        </div>
    </div>

    

                <!-- Question 5: simple math + validation-bypass challenge -->
                <div id="mission5" class="page">
            <div class="main-content">
                        <h3 class="text-2xl md:text-3xl font-semibold text-white mb-6">Question 5</h3>

                <!-- Blurred container (solver must unblur via DOM manipulation) -->
            <div id="blurred-box-5" class="p-6 rounded-xl bg-neutral-950 border border-neutral-800/70 shadow-[0_0_0_1px_rgba(255,255,255,0.03),0_8px_30px_-10px_rgba(0,0,0,0.7)] max-w-2xl mx-auto"
                         style="filter: blur(8px); transition: filter 200ms ease;">
                    <p class="mb-4">
                        hint: Bypass the frontend validation to reveal the hidden code.
                    </p>

                                <form id="math-form-5" class="space-y-4" autocomplete="off">
                                    <label for="q5" class="block text-sm font-medium">What is 2 + 2?</label>

                        <!-- Strict frontend validation: only '4' matches the pattern.
                                 The JS intentionally rejects all normal submissions to force a bypass. -->
                     <input id="q5" name="q5" type="text"
                                     class="px-3 py-2 rounded bg-gray-900 border border-gray-700 text-white w-full"
                                     placeholder="Enter your answer"
                                     required pattern="^4$" />

                        <div class="flex gap-2">
                            <button type="submit" class="px-4 py-2 bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 rounded text-white">
                                Submit

                        </div>

                        <p id="feedback" class="mt-2 text-sm text-red-400" aria-live="polite"></p>

                        <!-- Hidden reward revealed only after a bypass (see script) -->
                                    <div id="q5-reward" class="mt-4 hidden bg-neutral-900 border border-neutral-800 p-4 rounded">
                            <p class="font-mono text-green-400">
                                Answer: <code>DOM_PWNED_1337</code>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>

                    <!-- Question 6: vague hint + download icon -->
                    <div id="mission6" class="page">
                <div class="main-content">
                            <h3 class="text-2xl md:text-3xl font-semibold text-white mb-6">Question 6</h3>

                    <style>
                        /* Vague, low-contrast aesthetic just for Question 6 */
                        #mission6 .vague-box {
                            position: relative;
                            overflow: hidden;
                        }
                        #mission6 .vague-box::before {
                            content: "";
                            position: absolute;
                            inset: 0;
                            background:
                              repeating-linear-gradient(
                                to bottom,
                                rgba(255,255,255,0.03) 0px,
                                rgba(255,255,255,0.03) 1px,
                                transparent 2px,
                                transparent 4px
                              ); /* subtle scanlines */
                            opacity: 0.6;
                            pointer-events: none;
                        }
                    </style>

                        <div class="vague-box p-6 rounded-xl bg-neutral-950 border border-neutral-900/70 shadow-[0_0_0_1px_rgba(255,255,255,0.03),0_8px_30px_-10px_rgba(0,0,0,0.6)] max-w-2xl mx-auto">
                            <div class="font-mono text-gray-300/80 select-none text-center">
                                <div class="whitespace-pre-line leading-relaxed">
    refer Kaggle 10000 Most Common Passwords
                                </div>
                                <div class="mt-6 flex justify-center">
                                    <a href="https://drive.google.com/file/d/1rNG8_y8_jO92xRR9UCny20YXlInYXrO2/view" target="_blank" rel="noopener noreferrer"
                                       class="inline-flex items-center gap-2 px-3 py-2 rounded border border-neutral-800 text-gray-300 hover:text-white hover:border-neutral-700 transition-colors"
                                       aria-label="Download file (opens in new tab)">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                            <path d="M12 3v10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                                            <path d="M8.5 10.5L12 13.5L15.5 10.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M4 15.5v2a2.5 2.5 0 0 0 2.5 2.5h11A2.5 2.5 0 0 0 20 17.5v-2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                                        </svg>
                                        <span>Download</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

                        <!-- Leaderboard Page -->
                        <div id="leaderboard" class="page">
                            <div class="main-content">
                                <div class="max-w-6xl mx-auto px-4 py-8">
                                    <h3 class="text-3xl md:text-4xl font-bold text-white mb-8 text-center"> Qualifier Round Leaderboard </h3>
                                    
                                    <div class="p-[1px] rounded-2xl bg-[linear-gradient(135deg,rgba(255,255,255,0.08),rgba(255,255,255,0.02))] shadow-[0_0_0_1px_rgba(255,255,255,0.03),0_8px_30px_-10px_rgba(0,0,0,0.7)]">
                                        <div class="rounded-2xl bg-neutral-950 border border-neutral-900/70 p-6 md:p-8">
                                            <div class="mb-6 text-center">
                                                <p class="text-gray-300 text-lg mb-2">Top CIA Operatives</p>
                                                <p class="text-gray-500 text-sm">Ranked by total mission points earned</p>
                                            </div>
                                            
                                            <div class="overflow-x-auto">
                                                <table id="leaderboard-table" class="w-full text-left">
                                                    <thead>
                                                        <tr class="border-b border-neutral-800">
                                                            <th class="py-3 px-4 text-white font-semibold">Rank</th>
                                                            <th class="py-3 px-4 text-white font-semibold">Agent ID</th>
                                                            <th class="py-3 px-4 text-white font-semibold">Team Members</th>
                                                            <th class="py-3 px-4 text-white font-semibold text-center">Total Points</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="leaderboard-body">
                                                        <!-- Leaderboard data will be populated by JavaScript -->
                                                        <tr>
                                                            <td colspan="4" class="py-8 text-center text-gray-500">
                                                                <div class="animate-pulse">Loading classified data...</div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="mt-6 text-center text-sm text-gray-500">
                                                <p>üîí Classified Intelligence Assessment Results</p>
                                                <p>Only the most skilled operatives reach the top ranks</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Question 7: time travel instruction + SHA-256 hash -->
                        <div id="mission7" class="page">
                    <div class="main-content">
                                <h3 class="text-2xl md:text-3xl font-semibold text-white mb-6">Question 7</h3>

                        <div class="p-[1px] rounded-2xl bg-[linear-gradient(135deg,rgba(255,255,255,0.08),rgba(255,255,255,0.02))] max-w-3xl mx-auto shadow-[0_0_0_1px_rgba(255,255,255,0.03),0_8px_30px_-10px_rgba(0,0,0,0.7)]">
                            <div class="rounded-2xl bg-neutral-950 border border-neutral-900/70 p-6 md:p-8">
                                <div class="space-y-4 text-gray-300">
                                    <p class="text-base md:text-lg">
                                        Travel back to
                                        <span class="font-semibold text-white">7 September 2004 10:45:29</span>
                                        and, according to
                                        <a href="https://www.worldometers.info/" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline underline-offset-2">worldometers</a>,
                                        find <span class="italic">U.S. spending on perfume ($U.S. millions) this year</span>.
                                    </p>
                                    <p class="text-sm text-gray-400">Write down just the number (digits only, remove commas/spaces). Now compute its SHA-256 yourself.</p>

                                    <div class="space-y-3 text-sm text-gray-400/90">
                                        <p class="text-gray-300">Compute SHA-256 of the number as plain text (no newline):</p>
                                        <div class="grid gap-3 md:grid-cols-2">
                                            <div class="rounded border border-neutral-800 bg-neutral-900 p-3">
                                                <p class="mb-1 text-gray-400">Linux / macOS</p>
                                                <pre class="text-xs text-gray-300 whitespace-pre-wrap"><code>echo -n 4821 | shasum -a 256</code></pre>
                                            </div>
                                            <div class="rounded border border-neutral-800 bg-neutral-900 p-3">
                                                <p class="mb-1 text-gray-400">Python</p>
                                                <pre class="text-[11px] text-gray-300 whitespace-pre-wrap"><code>import hashlib

        v = "4821"  # replace with your number (digits only)
        digest = hashlib.sha256(v.encode("utf-8")).hexdigest()
        print(digest)</code></pre>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500">Eg:Replace 4821 with the digits you found. Any SHA-256 tool is fine.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                // Intentionally strict: this handler always discourages normal answers.
                (function(){
                    const form = document.getElementById('math-form-5');
                    const hintBtn = document.getElementById('inspect-hint-5');
                    if (form) {
                        form.addEventListener('submit', function (e) {
                            e.preventDefault();
                            const inputEl = document.getElementById('q5');
                            const val = (inputEl?.value || '').trim();
                            const feedback = document.getElementById('feedback');

                            // Always complain regardless of correctness.
                            if (feedback) feedback.textContent = "Nah, that‚Äôs not the answer. Get better at maths.";

                            // Reward only if explicit override token present.
                            // The intended bypass is to remove the 'pattern' attribute or otherwise
                            // manipulate the DOM so the attacker can set input value to "OVERRIDE"
                            // or directly toggle the reward visibility.
                            if (val === 'OVERRIDE' || (inputEl && inputEl.dataset.override === '1')) {
                                document.getElementById('q5-reward')?.classList.remove('hidden');
                                if (feedback) feedback.textContent = "Code revealed.";
                            } else {
                                // Ensure reward stays hidden
                                document.getElementById('q5-reward')?.classList.add('hidden');
                            }
                        });
                    }
                    if (hintBtn) {
                        hintBtn.addEventListener('click', function () {
                            const feedback = document.getElementById('feedback');
                            if (feedback) feedback.textContent = "Open DevTools / Console and examine #blurred-box-5 and #q5 (no cheat provided).";
                        });
                    }
                })();
            </script>

        <script>
                // Lightweight scramble effect without GSAP bonus plugins (SplitText/ScrambleText)
                const textRevealPercent = 0.17; // portion of viewport width used as reveal radius
                let textRevealRadius = 100;

                const letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                const getRandomLetter = () => letters[Math.floor(Math.random() * letters.length)];

                let pageX = 0, pageY = 0;
                let scrollY = window.pageYOffset, scrollX = window.pageXOffset;

                let charSpans = [];
                let charData = [];
                let layoutObserver = null;
                let lastMeasureTs = 0;

                function splitTextIntoChars() {
                        const container = document.querySelector('#mission1 .text-block #riddle');
                        if (!container) return;
                        if (container.dataset.split === 'true') {
                                charSpans = Array.from(container.querySelectorAll('span[data-split="1"]'));
                                return;
                        }
                        // Walk the DOM and split only text nodes into span-wrapped characters
                        const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, {
                            acceptNode(node) {
                                // ignore empty/whitespace-only nodes
                                if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
                                return NodeFilter.FILTER_ACCEPT;
                            }
                        });
                        const textNodes = [];
                        while (walker.nextNode()) textNodes.push(walker.currentNode);

                        textNodes.forEach(node => {
                            const parent = node.parentNode;
                            const frag = document.createDocumentFragment();
                            for (const ch of node.nodeValue) {
                                const span = document.createElement('span');
                                span.textContent = ch; // keep normal spaces for wrapping
                                span.dataset.orig = ch;
                                span.setAttribute('data-split', '1');
                                frag.appendChild(span);
                            }
                            parent.replaceChild(frag, node);
                        });
                        container.dataset.split = 'true';
                        charSpans = Array.from(container.querySelectorAll('span[data-split="1"]'));
                }

        function updateCharData() {
                        scrollY = window.pageYOffset;
                        scrollX = window.pageXOffset;
                        charData = charSpans.map(el => {
                                const b = el.getBoundingClientRect();
                                return {
                                        el,
                                        pageY: b.top + scrollY + b.height / 2,
                                        pageX: b.left + scrollX + b.width / 2,
                                        isVisible: false,
                                        orig: el.dataset.orig || el.textContent
                                };
                        });
            lastMeasureTs = performance.now();
                }

                function handleResize() {
                        textRevealRadius = window.innerWidth * textRevealPercent;
                        updateCharData();
                }

        function updateOnInput(e) {
                        const mission1Active = document.getElementById('mission1')?.classList.contains('active');
                        if (!mission1Active || !charData.length) return;

                        if ("pageY" in e) {
                                pageX = e.pageX;
                                pageY = e.pageY;
                        } else {
                                // update based on scroll delta
                                const dy = window.pageYOffset - scrollY;
                                const dx = window.pageXOffset - scrollX;
                                scrollY += dy;
                                scrollX += dx;
                                pageY += dy;
                                pageX += dx;
                        }

                        // Periodically refresh measurements in case layout shifted
                        if (performance.now() - lastMeasureTs > 250) {
                            updateCharData();
                        }

                        for (const d of charData) {
                                const dx = pageX - d.pageX;
                                const dy = pageY - d.pageY;
                                const dist = Math.hypot(dx, dy);
                                const visible = dist < textRevealRadius;
                                if (visible !== d.isVisible || !visible) {
                                    d.isVisible = visible;
                                    if (visible) {
                                        d.el.textContent = d.orig;
                                    } else {
                                        // Keep whitespace and control chars intact; only scramble printable non-space
                                        if (/\s/.test(d.orig)) {
                                            d.el.textContent = d.orig;
                                        } else {
                                            d.el.textContent = getRandomLetter();
                                        }
                                    }
                                }
                        }
                }

                function initMission1() {
                        splitTextIntoChars();
                        handleResize();
                        // Observe layout changes inside the riddle to keep measurements fresh
                        const container = document.querySelector('#mission1 .text-block #riddle');
                        if (window.ResizeObserver && container) {
                            layoutObserver = new ResizeObserver(() => {
                                updateCharData();
                            });
                            layoutObserver.observe(container);
                        }
                        // Recompute when fonts have finished loading (affects layout)
                        if (document.fonts && document.fonts.ready) {
                            document.fonts.ready.then(() => updateCharData()).catch(() => {});
                        }
                        window.addEventListener('resize', handleResize);
                        window.addEventListener('pointermove', updateOnInput, { passive: true });
                        window.addEventListener('scroll', updateOnInput, { passive: true });
                        updateOnInput({ pageX: 0, pageY: 0 });
                }

        function teardown() {
                        window.removeEventListener('resize', handleResize);
                        window.removeEventListener('pointermove', updateOnInput);
                        window.removeEventListener('scroll', updateOnInput);
            if (layoutObserver) {
                try { layoutObserver.disconnect(); } catch {}
                layoutObserver = null;
            }
                }

        function showPage(pageId) {
                        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                        document.getElementById(pageId)?.classList.add('active');
                        teardown();
            if (pageId === 'mission1') initMission1();
            if (pageId === 'leaderboard') loadLeaderboard();
                }

                // Leaderboard functionality
                async function loadLeaderboard() {
                    try {
                        const response = await fetch('leaderboard.csv');
                        const csvText = await response.text();
                        const data = parseCSV(csvText);
                        displayLeaderboard(data);
                    } catch (error) {
                        console.error('Error loading leaderboard:', error);
                        document.getElementById('leaderboard-body').innerHTML = `
                            <tr>
                                <td colspan="4" class="py-8 text-center text-red-400">
                                    ‚ö†Ô∏è Error loading classified data. Check security clearance.
                                </td>
                            </tr>
                        `;
                    }
                }

                function parseCSV(csvText) {
                    const lines = csvText.trim().split('\n');
                    const headers = lines[0].split(',');
                    const data = [];

                    for (let i = 1; i < lines.length; i++) {
                        const values = parseCSVLine(lines[i]);
                        if (values.length >= 4) {
                            const entry = {
                                id: values[0],
                                startTime: values[1],
                                completionTime: values[2],
                                totalPoints: parseInt(values[3]) || 0,
                                studentEmail: values[6] || '',
                                teamMembers: values[9] || ''
                            };
                            
                            data.push(entry);
                        }
                    }

                    // Sort by total points (descending) and then by completion time (ascending)
                    return data.sort((a, b) => {
                        if (b.totalPoints !== a.totalPoints) {
                            return b.totalPoints - a.totalPoints;
                        }
                        return new Date(a.completionTime) - new Date(b.completionTime);
                    });
                }

                function parseCSVLine(line) {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    
                    result.push(current.trim());
                    return result;
                }

                function displayLeaderboard(data) {
                    const tbody = document.getElementById('leaderboard-body');
                    if (!tbody) return;

                    if (data.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="4" class="py-8 text-center text-gray-500">
                                    No mission data available
                                </td>
                            </tr>
                        `;
                        return;
                    }

                    let currentRank = 1;
                    let currentPoints = null;
                    let currentRankCount = 0;

                    tbody.innerHTML = data.map((entry, index) => {
                        // Handle tied scores
                        if (currentPoints !== entry.totalPoints) {
                            currentRank = index + 1;
                            currentPoints = entry.totalPoints;
                        }

                        const rankDisplay = getRankDisplay(currentRank);
                        const agentId = formatAgentId(entry.studentEmail);
                        const teamMembers = formatTeamMembers(entry.teamMembers);
                        const pointsClass = getPointsClass(entry.totalPoints);

                        return `
                            <tr class="border-b border-neutral-800/50 hover:bg-neutral-900/30 transition-colors">
                                <td class="py-3 px-4">
                                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${getRankBadgeClass(currentRank)} text-sm font-bold">
                                        ${rankDisplay}
                                    </span>
                                </td>
                                <td class="py-3 px-4">
                                    <div class="font-mono text-sm text-gray-300">${agentId}</div>
                                </td>
                                <td class="py-3 px-4">
                                    <div class="text-xs text-gray-400">${teamMembers}</div>
                                </td>
                                <td class="py-3 px-4 text-center">
                                    <span class="font-bold text-lg ${pointsClass}">${entry.totalPoints}</span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }

                function getRankDisplay(rank) {
                    if (rank === 1) return '1';
                    if (rank === 2) return 'ü•à';
                    if (rank === 3) return 'ü•â';
                    return rank;
                }

                function getRankBadgeClass(rank) {
                    if (rank === 1) return 'bg-yellow-500 text-black';
                    if (rank === 2) return 'bg-gray-400 text-black';
                    if (rank === 3) return 'bg-amber-600 text-white';
                    return 'bg-neutral-700 text-gray-300';
                }

                function formatAgentId(email) {
                    if (!email) return 'CLASSIFIED';
                    // Extract the ID part before @ symbol
                    const id = email.split('@')[0];
                    return id.toUpperCase();
                }

                function formatTeamMembers(teamMembers) {
                    if (!teamMembers || teamMembers.trim() === '') return 'Solo Mission';
                    
                    const members = teamMembers.split(',').map(member => {
                        const trimmed = member.trim();
                        if (trimmed) {
                            const id = trimmed.split('@')[0];
                            return id.toUpperCase();
                        }
                        return '';
                    }).filter(id => id);
                    
                    if (members.length === 0) return 'Solo Mission';
                    return members.join(', ');
                }

                function getPointsClass(points) {
                    if (points >= 50) return 'text-green-400';
                    if (points >= 40) return 'text-blue-400';
                    if (points >= 30) return 'text-yellow-400';
                    if (points >= 20) return 'text-orange-400';
                    return 'text-red-400';
                }

                document.addEventListener('DOMContentLoaded', () => {
                        showPage('mission1');
                });
        </script>

        
</body>
</html>